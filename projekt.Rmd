---
title: "Analiza angleške prve lige"
author: "Jan Založnik"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Izbira teme

Pri tem projektu bom analizira prvo angleško ligo v zadnjih 10 letih. Pri analizi slednje bom analiziral koliko boljše so ekipe na domači zelenici kot pa v gosteh, število golov na tekmo, število strelov v in izven okvira vrat, število kotov, število rumenih in rdečih kartonov in še več pomembnih statističnih podatkov. Dodal bom pa tudi sodnike, ki so na vsaki tekmi zelo pomemben dejavnik.

![](slike/epl.png)

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Uvozil sem podatke o prvi angleški ligi v obliki CSV s spletne strani https://datahub.io/sports-data/english-premier-league ter v obliki HTML z Wikipedije. Podatke imamo v treh razpredelnicah v obliki *tidy data*.

1. `Sezone` - osnovni statistični podatki o angleški prvi ligi (prva tabela)
  - `Domača_ekipa` - spremenljivka: ime ekipe (neurejen faktor),
  - `Gostujoča_ekipa` - spremenljivka: ime ekipe (neurejen faktor),
  - `Zadetki_domača_ekipa` - spremenljivka: število zadetkov domačih (število: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9; kjer nikoli nobena ekipa ni zadela več kot 9 zadetkov),
  - `Zadetki_gostujoca_ekipa` - spremenljivka: število zadetkov gostov (število: 0, 1, 2, 3, 4, 5, 6, 7; kjer nikoli nobena ekipa ni zadela več kot 7 zadetkov),
  - `Rezultat` - spremenljivka: Rezultat na koncu tekme (črka : H = zmaga domačih, D = izenačeno, A = zmaga gostov),
  - `Zadetki_domača_ekipa_polčas` - spremenljivka: število zadetkov domačih (število: 0, 1, 2, 3, 4, 5; kjer nikoli nobena ekipa ni zadela več kot 5 zadetkov)
  - `Zadetki_gostujoča_ekipa_polčas` - spremenljivka: število zadetkov domačih (število: 0, 1, 2, 3, 4, 5; kjer nikoli nobena ekipa ni zadela več kot 5 zadetkov)
  - `Rezultat_polčas` - spremenljivka: Rezultat ob polčasu (črka : H = vodstvo domačih, D = izenačeno, A = vodstvo gostov),
  - `Sodnik` - spremenljivka: ime in priimek sodnika (neurejen faktor)
  - `Streli_domaci` - spremenljivka: število strelov domačih (število),
  - `Streli_gostje` - spremenljivka: število strelov gostov (število),
  - `Streli_domaci_v_okvir` - spremenljivka: število strelov v okvir domači (število),
  - `Streli_gostje_v_okvir` - spremenljivka: število strelov gostov (število),
  - `Prekrski_domači` - spremenljivka: število prekrškov domači (število),
  - `Prekrski_gostje` - spremenljivka: število prekrškov gostje (število),
  - `Koti_domaci` - spremenljivka: število kotov domači (število),
  - `Koti_gostje` - spremenljivka: število kotov gostje (število),
  - `Rumeni_karton_domaci` - spremenljivka: število rumenih kartovno domači (število),
  - `Rumeni_karton_gostje` - spremenljivka: število rumenih kartonov gostje (število),
  - `Rdec_karton_domaci` - spremenljivka: število rdečih kartonov domači (število),
  - `Rdec_karton_gostje` - spremenljivka: število rdečih kartonov gostje (število),
  - `Kvota_zmaga_domacin` - spremenljivka: kvota za zmago domačih (število),
  - `Kvota_neodloceno` - spremenljivka: kvota za neodločen izid (število)
  - `Kvota_zamga_gost` - spremenljivka: kvota za zmago gostov (število).
  

2. `Najboljsi_trenerji` - trenerji, ki so osvojili ligo
  - `Leto` - spremenljivka: leto (število),
  - `Trener` - spremenljivka: ime in priimek trenerja (neurejen faktor),
  - `Klub` - spremenljivka: s katerim klubom je trener osvojil ligo (besedilo).
  
3. `Trenutni_trenerji` - trenutni trenerji klubov
  - `Name` - spremenljivka: ime in priiimek trenerja (besedilo),
  - `Club` - spremenljivka: ime kluba (besedilo),
  - `Appointed` - spremenljivka: datum, ko so predstavili trenerja (števili in besedilo).



Spodnji graf prikazuje porazdelitev števila naselij v občinah.

```{r histogram, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Histogram števila naselij v občinah'}
ggplot(obcine, aes(x=naselja)) + geom_histogram() +
  ggtitle("Pogostost števila naselij") + xlab("Število naselij") + ylab("Število občin")
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("vizualizacija/vizualizacija.r", encoding="UTF-8")
```

Cilj moje naloge je ugotoviti, katere ekipe so v zadnjih desetih letih najbolj uspešne in kako to sovpada s statističnimi podatki, želim pokazati, da so ekipe načeloma uspešnejše, ko igrajo na domačem terenu. Zanimajo me tudi bolj splošni podatki, kot je na primer poštenost ekip, ki se kaže z rumenimi in rdečimi kartoni. Pokazal bom tudi, da je število kartonov zelo odvisna od sodnika, torej da nekateri sodniki hitreje posežejo po kartonu kot drugi(to bom pokazal s povprečjem, ki ga ima posamezen sodnik, na primer Mark Klettenburg 3.2 rumenih kartonov in 0.2 rdečih kartonov na tekmo).

```{r Zadetki, echo=FALSE, fig.align='center',message=FALSE, warning=FALSE}
print(Primerjava_zadetkov_domace_gostujoce_ekipe_graf)
```




```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
ggplot() + geom_polygon(data=left_join(zemljevid, povprecja, by=c("OB_UIME"="obcina")),
                        aes(x=long, y=lat, group=group, fill=povprecje)) +
  ggtitle("Povprečno število otrok v družini") + xlab("") + ylab("") +
  guides(fill=guide_colorbar(title="Povprečje"))
```

***

# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE}
source("analiza/analiza.r", encoding="UTF-8")
```

Spodnji graf prikazuje povezavo med številom naselij in površino občine.

```{r graf, echo=FALSE, fig.align='center', fig.cap='Povezava med številom naselij in površino občine'}
ggplot(inner_join(obcine, data.frame(obcina=names(skupine),
                                     skupina=factor(skupine)), by="obcina")
, aes(x=povrsina, y=naselja, color=skupina, size=prebivalci/1000)) + geom_point() +
  ggtitle("Število naselij glede na površino občine") +
  xlab(expression("Površina (km"^2 * ")")) + ylab("Št. naselij") +
  guides(color=guide_legend(title="Skupina"),
         size=guide_legend(title="Prebivalci (* 1000)"))
```

***

```{r shiny, echo=FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```
